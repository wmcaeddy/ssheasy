<!doctype html>
<html>
  <head>
    <title>File Browser</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <!-- Dependencies - using vendor versions to ensure compatibility with forked angular-filemanager -->
    <script src="vendor/angular-filemanager/dep/jquery.min.js?v=2"></script>
    <script src="vendor/angular/angular.min.js?v=2"></script>
    <script src="vendor/angular-translate/dist/angular-translate.min.js?v=2"></script>
    <script src="vendor/ng-file-upload/dist/ng-file-upload.min.js?v=2"></script>
    <script src="vendor/angular-filemanager/dep/bootstrap.min.js?v=2"></script>
    <script src="vendor/angular-filemanager/dep/FileSaver.js?v=2"></script>

    <link rel="stylesheet" href="vendor/angular-filemanager/dep/bootstrap.min.css?v=2" />

    <!-- angular-filemanager - local forked version with SFTP bridges -->
    <link rel="stylesheet" href="vendor/angular-filemanager/angular-filemanager.min.css?v=2">
    <script src="vendor/angular-filemanager/angular-filemanager.min.js?v=2"></script>
  </head>
  <body>
      <div class="ng-cloak">
          <angular-filemanager></angular-filemanager>
      </div>
      <script type="text/javascript">
        // Wait for window load (all resources loaded) before bootstrapping
        window.onload = function() {
            // Verify FileManagerApp module exists before configuring
            try {
                angular.module('FileManagerApp').config(['fileManagerConfigProvider', function (config) {
                    var defaults = config.$get();
                    config.set({
                        appName: 'angular-filemanager',
                        basePath: window.parent.home,
                        multiLang: false,
                        pickCallback: function(item) {
                            var msg = 'Picked %s "%s" for external use'
                                .replace('%s', item.type)
                                .replace('%s', item.fullPath());
                            window.alert(msg);
                        },
                        allowedActions: angular.extend(defaults.allowedActions, {
                            pickFiles: false,
                            pickFolders: false,
                        }),
                    });
                }]);

                // Manually bootstrap Angular app
                angular.bootstrap(document, ['FileManagerApp']);
            } catch(e) {
                console.error('Failed to initialize FileManagerApp:', e);
                document.body.innerHTML = '<div style="padding:20px;color:red;">File browser failed to load. Please refresh the page.</div>';
            }
        };
      </script>
  </body>
</html>